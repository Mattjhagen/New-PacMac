<!DOCTYPE html>
<html>
<head>
    <title>Analyze Main Site Scripts</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .script-section { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç Analyze Main Site Script Issues</h1>
    <div id="results"></div>
    
    <script>
        async function analyzeMainSite() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p class="info">üîÑ Analyzing main site script structure...</p>';
            
            try {
                // Fetch the live site
                const response = await fetch('https://pacmacmobile.com');
                const html = await response.text();
                
                // Find all script tags
                const allScripts = html.match(/<script[^>]*>[\s\S]*?<\/script>/gi) || [];
                const externalScripts = html.match(/<script[^>]*src=["']([^"']*)["'][^>]*>/gi) || [];
                
                resultsDiv.innerHTML += `<p class="info">Found ${allScripts.length} total script tags, ${externalScripts.length} external scripts</p>`;
                
                // Analyze external scripts
                resultsDiv.innerHTML += '<div class="script-section">';
                resultsDiv.innerHTML += '<h3>üìÑ External Scripts Analysis:</h3>';
                
                externalScripts.forEach((script, index) => {
                    const srcMatch = script.match(/src=["']([^"']*)["']/);
                    if (srcMatch) {
                        const src = srcMatch[1];
                        resultsDiv.innerHTML += `<h4>Script ${index + 1}: ${src}</h4>`;
                        
                        // Categorize the script
                        if (src.startsWith('http')) {
                            resultsDiv.innerHTML += `<p class="info">üåê External URL</p>`;
                        } else {
                            resultsDiv.innerHTML += `<p class="warning">üìÅ Local file (relative path)</p>`;
                        }
                        
                        // Check if it's a critical script
                        if (src.includes('config') || src.includes('inventory') || src.includes('products')) {
                            resultsDiv.innerHTML += `<p class="error">‚ö†Ô∏è CRITICAL: This script is likely needed for product display!</p>`;
                        }
                        
                        resultsDiv.innerHTML += `<pre>${script}</pre>`;
                    }
                });
                resultsDiv.innerHTML += '</div>';
                
                // Check for inline scripts that might be doing the work
                resultsDiv.innerHTML += '<div class="script-section">';
                resultsDiv.innerHTML += '<h3>üìÑ Inline Scripts Analysis:</h3>';
                
                const inlineScripts = allScripts.filter(script => !script.includes('src='));
                resultsDiv.innerHTML += `<p>Found ${inlineScripts.length} inline scripts</p>`;
                
                inlineScripts.forEach((script, index) => {
                    const content = script.replace(/<script[^>]*>|<\/script>/gi, '').trim();
                    if (content.length > 0) {
                        resultsDiv.innerHTML += `<h4>Inline Script ${index + 1}:</h4>`;
                        
                        // Check for product-related code
                        if (content.includes('PRODUCTS') || content.includes('showProducts') || content.includes('displayProducts')) {
                            resultsDiv.innerHTML += `<p class="success">‚úÖ Contains product display logic</p>`;
                        }
                        
                        // Show first 200 characters
                        resultsDiv.innerHTML += `<pre>${content.substring(0, 200)}...</pre>`;
                    }
                });
                resultsDiv.innerHTML += '</div>';
                
                // Check for the showProducts function specifically
                resultsDiv.innerHTML += '<div class="script-section">';
                resultsDiv.innerHTML += '<h3>üéØ Product Display Function Check:</h3>';
                
                if (html.includes('function showProducts') || html.includes('showProducts(')) {
                    resultsDiv.innerHTML += `<p class="success">‚úÖ showProducts function found</p>`;
                } else {
                    resultsDiv.innerHTML += `<p class="error">‚ùå showProducts function NOT found</p>`;
                }
                
                if (html.includes('DOMContentLoaded') || html.includes('window.onload')) {
                    resultsDiv.innerHTML += `<p class="success">‚úÖ Page load event handlers found</p>`;
                } else {
                    resultsDiv.innerHTML += `<p class="warning">‚ö†Ô∏è No page load event handlers found</p>`;
                }
                
                // Check if products are being called to display
                if (html.includes('showProducts()') || html.includes('displayProducts()')) {
                    resultsDiv.innerHTML += `<p class="success">‚úÖ Product display function is being called</p>`;
                } else {
                    resultsDiv.innerHTML += `<p class="error">‚ùå Product display function is NOT being called</p>`;
                }
                resultsDiv.innerHTML += '</div>';
                
                // Recommendations
                resultsDiv.innerHTML += '<div class="script-section">';
                resultsDiv.innerHTML += '<h3>üí° Solution:</h3>';
                resultsDiv.innerHTML += '<p><strong>The issue is that critical local scripts (config.js, inventory-api.js) are missing from the main site repository.</strong></p>';
                resultsDiv.innerHTML += '<p><strong>Fix:</strong> Either:</p>';
                resultsDiv.innerHTML += '<ol>';
                resultsDiv.innerHTML += '<li><strong>Create the missing scripts</strong> in the New-PacMac repository</li>';
                resultsDiv.innerHTML += '<li><strong>Remove the script references</strong> and put all the code inline</li>';
                resultsDiv.innerHTML += '<li><strong>Fix the script paths</strong> to point to existing files</li>';
                resultsDiv.innerHTML += '</ol>';
                resultsDiv.innerHTML += '</div>';
                
            } catch (error) {
                resultsDiv.innerHTML += `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Run the analysis
        analyzeMainSite();
    </script>
</body>
</html>
