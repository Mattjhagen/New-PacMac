<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacMac Mobile - Inventory Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #007AFF;
            margin-bottom: 10px;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .tab-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1d1d1f;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007AFF;
        }
        
        .image-upload {
            border: 2px dashed #007AFF;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .image-upload:hover {
            background: #f0f4ff;
        }
        
        .image-upload.dragover {
            background: #e6f2ff;
            border-color: #0056b3;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #0056b3;
        }

        /* Order Management Styles */
        .orders-table-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .orders-table th,
        .orders-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e5e7;
        }

        .orders-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1d1d1f;
        }

        .orders-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-processing {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-shipped {
            background: #d4edda;
            color: #155724;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn.primary {
            background: #007AFF;
            color: white;
        }

        .action-btn.success {
            background: #28a745;
            color: white;
        }

        .action-btn.warning {
            background: #ffc107;
            color: #212529;
        }

        .action-btn.danger {
            background: #dc3545;
            color: white;
        }

        .action-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #8e8e93;
        }
        
        .btn-secondary:hover {
            background: #6d6d70;
        }
        
        .btn-danger {
            background: #ff3b30;
        }
        
        .btn-danger:hover {
            background: #d70015;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .inventory-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .inventory-card:hover {
            transform: translateY(-2px);
        }
        
        .inventory-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .inventory-card h3 {
            margin-bottom: 10px;
            color: #1d1d1f;
        }
        
        .inventory-card .price {
            font-size: 18px;
            font-weight: 600;
            color: #007AFF;
            margin-bottom: 10px;
        }
        
        .inventory-card .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .tag {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #007AFF;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #8e8e93;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“± PacMac Mobile Inventory Admin</h1>
            <p>Manage your product inventory, pricing, and images</p>
        </div>
        
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="showTab('add-product')">Add Product</button>
            <button class="tab-btn" onclick="showTab('manage-inventory')">Manage Inventory</button>
            <button class="tab-btn" onclick="showTab('order-management')">Order Management</button>
            <button class="tab-btn" onclick="showTab('export-import')">Export/Import</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-products">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-value">$0</div>
                    <div class="stat-label">Total Inventory Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="new-products">0</div>
                    <div class="stat-label">New This Week</div>
                </div>
            </div>
            
            <div class="form-section">
                <h2>Quick Actions</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="showTab('add-product')">Add New Product</button>
                    <button class="btn btn-secondary" onclick="exportInventory()">Export Inventory</button>
                    <button class="btn btn-secondary" onclick="importInventory()">Import Inventory</button>
                    <button class="btn btn-secondary" onclick="syncToMainSite()">Sync to Main Site</button>
                </div>
            </div>
        </div>
        
        <!-- Add Product Tab -->
        <div id="add-product" class="tab-content">
            <div class="form-section">
                <h2>Add New Product</h2>
                <form id="product-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="product-name">Product Name *</label>
                            <input type="text" id="product-name" required placeholder="e.g., iPhone 15 Pro Max">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-id">Product ID *</label>
                            <input type="text" id="product-id" required placeholder="e.g., pm-iphone15promax">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-price">Price *</label>
                            <input type="number" id="product-price" step="0.01" required placeholder="999.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-category">Category</label>
                            <select id="product-category">
                                <option value="main">Main Product</option>
                                <option value="refurbished">Refurbished</option>
                                <option value="accessory">Accessory</option>
                            </select>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-description">Description</label>
                            <textarea id="product-description" rows="3" placeholder="Brief product description"></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-specs">Specifications (JSON format)</label>
                            <textarea id="product-specs" rows="4" placeholder='{"storage": "128GB", "color": "Space Black", "condition": "Like New"}'></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-tags">Tags (comma-separated)</label>
                            <input type="text" id="product-tags" placeholder="iPhone, 128GB, Space Black, Like New">
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Product Image</label>
                            <div class="image-upload" id="image-upload" onclick="document.getElementById('image-input').click()">
                                <div id="upload-text">
                                    <p>ðŸ“· Click to upload image or drag & drop</p>
                                    <p style="font-size: 14px; color: #8e8e93;">Recommended: 400x400px, JPG/PNG</p>
                                </div>
                                <img id="image-preview" class="image-preview" style="display: none;">
                                <input type="file" id="image-input" accept="image/*" style="display: none;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">Add Product</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Manage Inventory Tab -->
        <div id="manage-inventory" class="tab-content">
            <div class="form-section">
                <h2>Current Inventory</h2>
                <div id="inventory-grid" class="inventory-grid">
                    <!-- Inventory items will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Order Management Tab -->
        <div id="order-management" class="tab-content">
            <div class="form-section">
                <h2>ðŸ“¦ Order Management</h2>
                <p>Manage customer orders, payments, and shipping status</p>
                
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-number" id="total-orders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-orders">0</div>
                        <div class="stat-label">Pending Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completed-orders">0</div>
                        <div class="stat-label">Completed Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-revenue">$0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>

                <div class="order-filters" style="margin-bottom: 20px;">
                    <button class="btn" onclick="filterOrders('all')">All Orders</button>
                    <button class="btn" onclick="filterOrders('pending')">Pending</button>
                    <button class="btn" onclick="filterOrders('processing')">Processing</button>
                    <button class="btn" onclick="filterOrders('shipped')">Shipped</button>
                    <button class="btn" onclick="filterOrders('completed')">Completed</button>
                    <button class="btn" onclick="filterOrders('cancelled')">Cancelled</button>
                </div>

                <div class="orders-table-container">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <!-- Orders will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Export/Import Tab -->
        <div id="export-import" class="tab-content">
            <div class="form-section">
                <h2>Export/Import Inventory</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h3>Export Inventory</h3>
                        <p>Download your current inventory as a JSON file for backup or sharing.</p>
                        <button class="btn" onclick="exportInventory()">Export to JSON</button>
                    </div>
                    <div>
                        <h3>Import Inventory</h3>
                        <p>Upload a JSON file to restore or update your inventory.</p>
                        <input type="file" id="import-file" accept=".json" style="margin-bottom: 15px;">
                        <br>
                        <button class="btn btn-secondary" onclick="importInventory()">Import from JSON</button>
                    </div>
                </div>
                <div class="export-section">
                    <h3>Import from Wholesaler XLSX</h3>
                    <p>Upload your wholesaler's Excel file to automatically import inventory.</p>
                    <input type="file" id="xlsx-file" accept=".xlsx,.xls" style="margin-bottom: 15px;">
                    <br>
                    <button class="btn" onclick="importFromXLSX()">Import from XLSX</button>
                    <div id="xlsx-preview" class="hidden"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Inventory Management System
        class InventoryManager {
            constructor() {
                this.inventory = this.loadInventory();
                this.initializeEventListeners();
                this.updateDashboard();
                this.loadInventoryGrid();
            }
            
            loadInventory() {
                const saved = localStorage.getItem('pmm-inventory');
                if (saved) {
                    return JSON.parse(saved);
                }
                return [];
            }
            
            saveInventory() {
                localStorage.setItem('pmm-inventory', JSON.stringify(this.inventory));
                this.updateDashboard();
                this.loadInventoryGrid();
            }
            
            addProduct(productData) {
                const product = {
                    id: productData.id,
                    name: productData.name,
                    price: parseFloat(productData.price),
                    category: productData.category || 'main',
                    description: productData.description || '',
                    specs: this.parseSpecs(productData.specs),
                    tags: productData.tags ? productData.tags.split(',').map(t => t.trim()) : [],
                    img: productData.imageData || 'products/placeholder.jpg',
                    dateAdded: new Date().toISOString()
                };
                
                this.inventory.push(product);
                this.saveInventory();
                return product;
            }
            
            parseSpecs(specsString) {
                if (!specsString) return {};
                try {
                    return JSON.parse(specsString);
                } catch (e) {
                    // If not valid JSON, create a simple object
                    return { note: specsString };
                }
            }
            
            updateProduct(id, updates) {
                const index = this.inventory.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.inventory[index] = { ...this.inventory[index], ...updates };
                    this.saveInventory();
                }
            }
            
            deleteProduct(id) {
                this.inventory = this.inventory.filter(p => p.id !== id);
                this.saveInventory();
            }
            
            updateDashboard() {
                const totalProducts = this.inventory.length;
                const totalValue = this.inventory.reduce((sum, p) => sum + p.price, 0);
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                const newProducts = this.inventory.filter(p => new Date(p.dateAdded) > weekAgo).length;
                
                document.getElementById('total-products').textContent = totalProducts;
                document.getElementById('total-value').textContent = `$${totalValue.toLocaleString()}`;
                document.getElementById('new-products').textContent = newProducts;
            }
            
            loadInventoryGrid() {
                const grid = document.getElementById('inventory-grid');
                grid.innerHTML = '';
                
                this.inventory.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'inventory-card';
                    card.innerHTML = `
                        <img src="${product.img}" alt="${product.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><rect width=\'100\' height=\'100\' fill=\'%23f0f0f0\'/><text x=\'50\' y=\'50\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'>No Image</text></svg>'">
                        <h3>${product.name}</h3>
                        <div class="price">$${product.price.toFixed(2)}</div>
                        <div class="tags">
                            ${product.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary" onclick="inventoryManager.editProduct('${product.id}')">Edit</button>
                            <button class="btn btn-danger" onclick="inventoryManager.deleteProduct('${product.id}')">Delete</button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
            
            editProduct(id) {
                const product = this.inventory.find(p => p.id === id);
                if (product) {
                    // Populate form with product data
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-id').value = product.id;
                    document.getElementById('product-price').value = product.price;
                    document.getElementById('product-category').value = product.category;
                    document.getElementById('product-description').value = product.description;
                    document.getElementById('product-specs').value = JSON.stringify(product.specs, null, 2);
                    document.getElementById('product-tags').value = product.tags.join(', ');
                    
                    if (product.img && product.img.startsWith('data:')) {
                        document.getElementById('image-preview').src = product.img;
                        document.getElementById('image-preview').style.display = 'block';
                        document.getElementById('upload-text').style.display = 'none';
                    }
                    
                    showTab('add-product');
                }
            }
            
            initializeEventListeners() {
                // Form submission
                document.getElementById('product-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleFormSubmit();
                });
                
                // Image upload
                const imageInput = document.getElementById('image-input');
                const imageUpload = document.getElementById('image-upload');
                
                imageInput.addEventListener('change', (e) => {
                    this.handleImageUpload(e.target.files[0]);
                });
                
                // Drag and drop
                imageUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    imageUpload.classList.add('dragover');
                });
                
                imageUpload.addEventListener('dragleave', () => {
                    imageUpload.classList.remove('dragover');
                });
                
                imageUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    imageUpload.classList.remove('dragover');
                    this.handleImageUpload(e.dataTransfer.files[0]);
                });
            }
            
            handleFormSubmit() {
                const formData = {
                    name: document.getElementById('product-name').value,
                    id: document.getElementById('product-id').value,
                    price: document.getElementById('product-price').value,
                    category: document.getElementById('product-category').value,
                    description: document.getElementById('product-description').value,
                    specs: document.getElementById('product-specs').value,
                    tags: document.getElementById('product-tags').value,
                    imageData: document.getElementById('image-preview').src
                };
                
                // Check if editing existing product
                const existingIndex = this.inventory.findIndex(p => p.id === formData.id);
                
                if (existingIndex !== -1) {
                    this.updateProduct(formData.id, {
                        name: formData.name,
                        price: parseFloat(formData.price),
                        category: formData.category,
                        description: formData.description,
                        specs: this.parseSpecs(formData.specs),
                        tags: formData.tags ? formData.tags.split(',').map(t => t.trim()) : [],
                        img: formData.imageData
                    });
                    this.showAlert('Product updated successfully!', 'success');
                } else {
                    this.addProduct(formData);
                    this.showAlert('Product added successfully!', 'success');
                }
                
                this.clearForm();
            }
            
            handleImageUpload(file) {
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    this.showAlert('Please select a valid image file.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('image-preview').src = e.target.result;
                    document.getElementById('image-preview').style.display = 'block';
                    document.getElementById('upload-text').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
            
            clearForm() {
                document.getElementById('product-form').reset();
                document.getElementById('image-preview').style.display = 'none';
                document.getElementById('upload-text').style.display = 'block';
            }
            
            showAlert(message, type) {
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                
                const container = document.querySelector('.container');
                container.insertBefore(alert, container.firstChild);
                
                setTimeout(() => {
                    alert.remove();
                }, 3000);
            }
            
            exportInventory() {
                const dataStr = JSON.stringify(this.inventory, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `pmm-inventory-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
            }
            
            importInventory() {
                const fileInput = document.getElementById('import-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    this.showAlert('Please select a file to import.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (Array.isArray(importedData)) {
                            this.inventory = importedData;
                            this.saveInventory();
                            this.showAlert('Inventory imported successfully!', 'success');
                        } else {
                            this.showAlert('Invalid file format.', 'error');
                        }
                    } catch (error) {
                        this.showAlert('Error reading file: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            }
            
            syncToMainSite() {
                // Generate JavaScript code for main site
                const jsCode = this.generateProductsArrayCode();
                
                // Create a new window with the generated code
                const newWindow = window.open('', '_blank', 'width=800,height=600');
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Generated PRODUCTS Array</title>
                        <style>
                            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 20px; background: #f5f5f7; }
                            .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                            pre { background: #f8f9fa; padding: 20px; border-radius: 8px; overflow-x: auto; border: 1px solid #e5e5e7; }
                            .copy-btn { background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin: 15px 0; font-weight: 600; }
                            .copy-btn:hover { background: #0056b3; }
                            .instructions { background: #e6f2ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <h1>ðŸ“± Generated PRODUCTS Array</h1>
                            <div class="instructions">
                                <strong>Instructions:</strong><br>
                                1. Click "Copy to Clipboard" below<br>
                                2. Open your index.html file<br>
                                3. Find the PRODUCTS array (around line 400)<br>
                                4. Replace the entire PRODUCTS array with the copied code<br>
                                5. Save and deploy your site
                            </div>
                            
                            <button class="copy-btn" onclick="copyToClipboard()">ðŸ“‹ Copy to Clipboard</button>
                            
                            <pre id="code-block">${jsCode}</pre>
                        </div>
                        
                        <scr' + 'ipt>
                            function copyToClipboard() {
                                const codeBlock = document.getElementById('code-block');
                                navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                                    alert('âœ… Code copied to clipboard!\\n\\nNow paste it into your index.html file to replace the PRODUCTS array.');
                                }).catch(err => {
                                    // Fallback for older browsers
                                    const textArea = document.createElement('textarea');
                                    textArea.value = codeBlock.textContent;
                                    document.body.appendChild(textArea);
                                    textArea.select();
                                    document.execCommand('copy');
                                    document.body.removeChild(textArea);
                                    alert('âœ… Code copied to clipboard!');
                                });
                            }
                        </scr' + 'ipt>
                    </body>
                    </html>
                `);
            }
            
            generateProductsArrayCode() {
                const markupPercentage = 22; // 22% markup
                
                const products = this.inventory.map(item => {
                    const priceWithMarkup = (item.price * (1 + markupPercentage / 100)).toFixed(2);
                    
                    return {
                        id: item.id,
                        name: item.name,
                        price: parseFloat(priceWithMarkup),
                        tags: item.tags || [],
                        img: item.img,
                        description: item.description || '',
                        specs: item.specs || {}
                    };
                });
                
                let jsCode = `const PRODUCTS = [\n`;
                
                products.forEach((product, index) => {
                    jsCode += `  {\n`;
                    jsCode += `    id: '${product.id}',\n`;
                    jsCode += `    name: '${product.name.replace(/'/g, "\\'")}',\n`;
                    jsCode += `    price: ${product.price},\n`;
                    jsCode += `    tags: [${product.tags.map(tag => `'${tag.replace(/'/g, "\\'")}'`).join(', ')}],\n`;
                    jsCode += `    img: '${product.img}',\n`;
                    jsCode += `    description: '${product.description.replace(/'/g, "\\'")}',\n`;
                    jsCode += `    specs: ${JSON.stringify(product.specs, null, 4).replace(/^/gm, '    ')}\n`;
                    jsCode += `  }${index < products.length - 1 ? ',' : ''}\n`;
                });
                
                jsCode += `];\n\n`;
                jsCode += `// Generated on ${new Date().toISOString()}\n`;
                jsCode += `// Total products: ${products.length}\n`;
                jsCode += `// Markup applied: ${markupPercentage}%\n`;
                
                return jsCode;
            }
        }
        
        // Global functions
        
        function clearForm() {
            inventoryManager.clearForm();
        }
        
        function exportInventory() {
            inventoryManager.exportInventory();
        }
        
        function importInventory() {
            inventoryManager.importInventory();
        }
        
        function syncToMainSite() {
            inventoryManager.syncToMainSite();
        }

        // Order Management Functions
        let orders = [
            {
                id: 'ORD-001',
                customer: 'John Doe',
                email: 'john@example.com',
                items: ['iPhone 15 Pro Max 256GB'],
                total: 879.20,
                status: 'pending',
                date: '2025-09-18',
                paymentStatus: 'paid',
                shippingAddress: '123 Main St, Omaha, NE 68102'
            },
            {
                id: 'ORD-002',
                customer: 'Jane Smith',
                email: 'jane@example.com',
                items: ['MacBook Pro 14-inch M3', 'Nike Air Jordan 1 Retro High'],
                total: 1978.10,
                status: 'processing',
                date: '2025-09-17',
                paymentStatus: 'paid',
                shippingAddress: '456 Oak Ave, Lincoln, NE 68508'
            },
            {
                id: 'ORD-003',
                customer: 'Mike Johnson',
                email: 'mike@example.com',
                items: ['Samsung Galaxy S24 Ultra'],
                total: 989.10,
                status: 'shipped',
                date: '2025-09-16',
                paymentStatus: 'paid',
                shippingAddress: '789 Pine St, Grand Island, NE 68801'
            },
            {
                id: 'ORD-004',
                customer: 'Sarah Wilson',
                email: 'sarah@example.com',
                items: ['Apple Watch Series 9'],
                total: 399.00,
                status: 'completed',
                date: '2025-09-15',
                paymentStatus: 'paid',
                shippingAddress: '321 Elm St, Kearney, NE 68847'
            }
        ];

        function loadOrders() {
            updateOrderStats();
            renderOrdersTable();
        }

        function updateOrderStats() {
            const totalOrders = orders.length;
            const pendingOrders = orders.filter(o => o.status === 'pending').length;
            const completedOrders = orders.filter(o => o.status === 'completed').length;
            const totalRevenue = orders.reduce((sum, o) => sum + o.total, 0);

            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('pending-orders').textContent = pendingOrders;
            document.getElementById('completed-orders').textContent = completedOrders;
            document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
        }

        function renderOrdersTable(filterStatus = 'all') {
            const tbody = document.getElementById('orders-table-body');
            const filteredOrders = filterStatus === 'all' ? orders : orders.filter(o => o.status === filterStatus);

            tbody.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td><strong>${order.id}</strong></td>
                    <td>
                        <div>${order.customer}</div>
                        <small style="color: #666;">${order.email}</small>
                    </td>
                    <td>
                        <div>${order.items.length} item(s)</div>
                        <small style="color: #666;">${order.items.join(', ')}</small>
                    </td>
                    <td><strong>$${order.total.toFixed(2)}</strong></td>
                    <td>
                        <span class="status-badge status-${order.status}">${order.status}</span>
                    </td>
                    <td>${order.date}</td>
                    <td>
                        <div class="order-actions">
                            <button class="action-btn primary" onclick="viewOrder('${order.id}')">View</button>
                            ${getStatusActionButtons(order)}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusActionButtons(order) {
            switch (order.status) {
                case 'pending':
                    return `<button class="action-btn success" onclick="updateOrderStatus('${order.id}', 'processing')">Process</button>`;
                case 'processing':
                    return `<button class="action-btn warning" onclick="updateOrderStatus('${order.id}', 'shipped')">Ship</button>`;
                case 'shipped':
                    return `<button class="action-btn success" onclick="updateOrderStatus('${order.id}', 'completed')">Complete</button>`;
                case 'completed':
                    return `<button class="action-btn primary" onclick="viewOrder('${order.id}')">View Details</button>`;
                default:
                    return '';
            }
        }

        function filterOrders(status) {
            renderOrdersTable(status);
            
            // Update active filter button
            document.querySelectorAll('.order-filters .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                renderOrdersTable();
                updateOrderStats();
                
                // Show success message
                alert(`Order ${orderId} status updated to ${newStatus}`);
            }
        }

        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                const details = `
Order ID: ${order.id}
Customer: ${order.customer}
Email: ${order.email}
Items: ${order.items.join(', ')}
Total: $${order.total.toFixed(2)}
Status: ${order.status}
Payment Status: ${order.paymentStatus}
Date: ${order.date}
Shipping Address: ${order.shippingAddress}
                `;
                alert(details);
            }
        }

        // Initialize order management when tab is shown
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            // Load orders when order management tab is shown
            if (tabName === 'order-management') {
                loadOrders();
            }
        }

        function importFromXLSX() {
            const fileInput = document.getElementById('xlsx-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an XLSX file first.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // Get the first worksheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert to JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Process the data
                    processWholesalerData(jsonData);
                    
                } catch (error) {
                    console.error('Error reading XLSX file:', error);
                    alert('Error reading XLSX file. Please check the format.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processWholesalerData(data) {
            // Preview the data first
            const preview = document.getElementById('xlsx-preview');
            preview.innerHTML = `
                <h4>Preview (First 5 rows):</h4>
                <table border="1" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            ${Object.keys(data[0] || {}).map(key => `<th>${key}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${data.slice(0, 5).map(row => `
                            <tr>
                                ${Object.values(row).map(value => `<td>${value}</td>`).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <p><strong>Total rows:</strong> ${data.length}</p>
                <button class="btn" onclick="confirmImport(${JSON.stringify(data).replace(/"/g, '&quot;')})">Confirm Import</button>
                <button class="btn btn-secondary" onclick="document.getElementById('xlsx-preview').classList.add('hidden')">Cancel</button>
            `;
            preview.classList.remove('hidden');
        }

        function confirmImport(data) {
            const products = data.map((row, index) => {
                // Map your wholesaler's columns to your product structure
                // Adjust these field mappings based on your XLSX structure
                return {
                    id: `pm-${row['Product ID'] || row['SKU'] || `item-${index}`}`,
                    name: row['Product Name'] || row['Name'] || row['Title'] || 'Unknown Product',
                    price: parseFloat(row['Price'] || row['Cost'] || row['Wholesale Price'] || 0),
                    category: 'main',
                    description: row['Description'] || row['Details'],
                    brand: row['Brand'] || row['Manufacturer'],
                    model: row['Model'] || row['Model Number'],
                    color: row['Color'] || row['Finish'],
                    storage: row['Storage'] || row['Capacity'],
                    condition: row['Condition'] || row['Grade']
                };
            });
            
            // Apply 22% markup
            products.forEach(product => {
                product.price = parseFloat((product.price * 1.22).toFixed(2));
            });
            
            // Replace current inventory
            inventoryManager.inventory = products;
            inventoryManager.saveInventory();
            
            // Hide preview and show success
            document.getElementById('xlsx-preview').classList.add('hidden');
            inventoryManager.showAlert(`Successfully imported ${products.length} products!`, 'success');
            
            // Refresh the display
            inventoryManager.updateDashboard();
            inventoryManager.loadInventoryGrid();
        }
        
        // Initialize the inventory manager
        const inventoryManager = new InventoryManager();
    </script>
    
    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/67b3b81ea5464a1908415ae0/1ikb0edp5';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->
</body>
</html>
