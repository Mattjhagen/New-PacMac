"use client";
import{a,b as u,c as f,d}from"./chunk-FPUCM3FX.js";import{useEffect as b}from"react";var o,s;function v(e){typeof window>"u"||typeof EventSource>"u"||!e||s||(s=e,o=new EventSource(`${e}/events`),l(),window.addEventListener("vercel-toolbar-ready",()=>{l()}))}function l(){let e=u();e?.isAuthenticated&&e.setLocalhostEventSource?.({subscribe:i,fetchLocal:p})}function i(e,r){if(!o)return()=>{};let n=t=>{try{let c=t.data&&typeof t.data=="string"?JSON.parse(t.data):void 0;c&&r(c)}catch{}};return o.addEventListener(e,n),()=>{o?.removeEventListener(e,n)}}async function p(e,r){if(!s)return{error:"No toolbar server"};try{let n=await fetch(`${s}${e}`,r?{method:"POST",body:JSON.stringify(r)}:void 0),t=await n.json();return n.ok?{result:t}:{error:t.error}}catch(n){return{error:`${n}`}}}async function m(){let e=await p("/branch");return"result"in e?e.result.branch:void 0}function E(){i("branch-change",e=>{e&&location.reload()})}function N({nonce:e}){return process.env.NODE_ENV!=="development"||b(()=>(v(process.env.NEXT_PUBLIC_VERCEL_TOOLBAR_SERVER),E(),m().then(r=>{r&&a(r),f({nonce:e})}),()=>{d()}),[]),null}export{N as LocalhostController};
