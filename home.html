<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PacMac Marketplace - Discover Nearby Items</title>
  <meta name="description" content="Discover and bid on nearby items in your local marketplace." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üõí</text></svg>">
  <style>
    :root {
      --primary: #FF6B6B;
      --secondary: #4ECDC4;
      --accent: #45B7D1;
      --success: #96CEB4;
      --warning: #FFEAA7;
      --purple: #A29BFE;
      --pink: #FD79A8;
      --orange: #FDCB6E;
      --gradient-1: linear-gradient(135deg, #FF6B6B, #4ECDC4);
      --gradient-2: linear-gradient(135deg, #45B7D1, #96CEB4);
      --gradient-3: linear-gradient(135deg, #A29BFE, #FD79A8);
      --gradient-4: linear-gradient(135deg, #FDCB6E, #FF6B6B);
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--gradient-1);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* User Dropdown */
    .user-dropdown {
      position: relative;
    }

    .user-menu-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 25px;
      transition: all 0.3s ease;
    }

    .user-menu-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .user-name {
      font-weight: 600;
      color: #333;
    }

    .dropdown-arrow {
      font-size: 0.8rem;
      color: #666;
      transition: transform 0.3s ease;
    }

    .user-menu-btn.active .dropdown-arrow {
      transform: rotate(180deg);
    }

    .user-dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 15px;
      box-shadow: var(--shadow-hover);
      min-width: 250px;
      padding: 1rem;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    .user-dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-section {
      margin-bottom: 1rem;
    }

    .dropdown-section:last-child {
      margin-bottom: 0;
    }

    .dropdown-section h4 {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .dropdown-section a {
      display: block;
      padding: 0.75rem 1rem;
      color: #333;
      text-decoration: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .dropdown-section a:hover {
      background: var(--gradient-1);
      color: white;
      transform: translateX(5px);
    }

    .credit-display {
      padding: 0.75rem 1rem;
      background: var(--gradient-2);
      color: white;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
    }

    .admin-section {
      border-top: 2px solid #ff6b6b;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
    }

    .admin-section h4 {
      color: #ff6b6b;
      font-weight: bold;
    }

    .admin-section a {
      background: rgba(255, 107, 107, 0.1);
      border-left: 3px solid #ff6b6b;
    }

    .admin-section a:hover {
      background: var(--gradient-1);
      transform: translateX(5px);
    }

    .credit-balance {
      background: var(--gradient-2);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .credit-icon {
      font-size: 1.1rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient-2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    /* Main Content */
    .main-content {
      padding: 2rem 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .welcome-section {
      text-align: center;
      margin-bottom: 2rem;
      color: white;
    }

    .welcome-title {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .welcome-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: 1rem;
    }

    .location-info {
      background: rgba(255, 255, 255, 0.2);
      padding: 1rem;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      display: inline-block;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .filter-btn {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: var(--shadow);
    }

    .filter-btn:hover, .filter-btn.active {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .filter-btn.active {
      background: var(--gradient-2);
      color: white;
    }

    /* Items Grid */
    .items-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .item-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .item-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    .item-image {
      width: 100%;
      height: 200px;
      background: var(--gradient-3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      position: relative;
    }

    .item-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--gradient-4);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .item-content {
      padding: 1.5rem;
    }

    .item-title {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: #333;
    }

    .item-description {
      color: #666;
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .item-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .item-price {
      font-size: 1.5rem;
      font-weight: bold;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .item-distance {
      color: #999;
      font-size: 0.9rem;
    }

    .item-bids {
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Item Details Styles */
    .item-details {
      margin: 1rem 0;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      backdrop-filter: blur(10px);
    }

    .item-reviews {
      color: #FFD700;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .item-seller {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.85rem;
      margin-bottom: 0.3rem;
    }

    .item-condition {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.85rem;
      margin-bottom: 0.3rem;
    }

    .item-warranty {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.8rem;
    }

    /* Item Image Styles */
    .item-image img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 15px 15px 0 0;
    }

    .item-emoji {
      font-size: 4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      background: var(--gradient-3);
      border-radius: 15px 15px 0 0;
    }

    .item-actions {
      display: flex;
      gap: 0.5rem;
    }

    /* Countdown Timer Styles */
    .countdown-timer {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 0.75rem;
      margin-top: 1rem;
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .countdown-label {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .countdown-display {
      font-family: 'Courier New', monospace;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .countdown-display .hours {
      color: #FF6B6B;
    }

    .countdown-display .minutes {
      color: #4ECDC4;
    }

    .countdown-display .seconds {
      color: #45B7D1;
    }

    .countdown-timer .expired {
      color: #ff4757;
      font-weight: bold;
      font-size: 1rem;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid #eee;
    }

    .modal-header h2 {
      margin: 0;
      color: #333;
      font-size: 1.5rem;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 2rem;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: #f5f5f5;
      color: #333;
    }

    /* Upload Form Styles */
    .upload-form {
      padding: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.2s ease;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* Image Upload Styles */
    .image-upload-area {
      border: 2px dashed #ddd;
      border-radius: 10px;
      padding: 2rem;
      text-align: center;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .image-upload-area:hover {
      border-color: var(--primary);
      background: rgba(255, 107, 107, 0.05);
    }

    .upload-placeholder {
      color: #666;
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .upload-placeholder p {
      margin: 0.5rem 0;
      font-weight: 500;
    }

    .upload-placeholder small {
      color: #999;
    }

    .image-preview {
      position: relative;
      display: inline-block;
    }

    .image-preview img {
      max-width: 200px;
      max-height: 200px;
      border-radius: 10px;
      object-fit: cover;
    }

    .remove-image {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #ff4757;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Form Actions */
    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .btn-cancel,
    .btn-submit {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-cancel {
      background: #f8f9fa;
      color: #666;
    }

    .btn-cancel:hover {
      background: #e9ecef;
    }

    .btn-submit {
      background: var(--gradient-1);
      color: white;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
    }

    .btn-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .action-btn {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .bid-btn {
      background: var(--gradient-2);
      color: white;
    }

    .heart-btn {
      background: var(--gradient-3);
      color: white;
    }

    .pass-btn {
      background: #f0f0f0;
      color: #666;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* Floating Action Button */
    .fab {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      background: var(--gradient-1);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: var(--shadow-hover);
      transition: all 0.3s ease;
      z-index: 50;
    }

    .fab:hover {
      transform: scale(1.1);
    }

    /* Loading States */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .welcome-title {
        font-size: 2rem;
      }
      
      .items-container {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .filters {
        padding: 0 1rem;
      }
      
      .main-content {
        padding: 1rem;
      }
    }

    /* Animations */
    .item-card {
      animation: slideUp 0.5s ease forwards;
      opacity: 0;
      transform: translateY(20px);
    }

    .item-card:nth-child(1) { animation-delay: 0.1s; }
    .item-card:nth-child(2) { animation-delay: 0.2s; }
    .item-card:nth-child(3) { animation-delay: 0.3s; }
    .item-card:nth-child(4) { animation-delay: 0.4s; }
    .item-card:nth-child(5) { animation-delay: 0.5s; }
    .item-card:nth-child(6) { animation-delay: 0.6s; }

    @keyframes slideUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">üõí PacMac</div>
      <div class="user-info">
        <div class="user-dropdown">
          <button class="user-menu-btn" onclick="toggleUserMenu()">
            <div class="user-avatar" id="userAvatar">U</div>
            <span class="user-name" id="userDisplayName">Hello, User</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>
          <div class="user-dropdown-menu" id="userDropdownMenu">
            <div class="dropdown-section">
              <h4>Verification</h4>
              <a href="#" onclick="showAddressVerification()">üìç Address Verification</a>
              <a href="#" onclick="showIdentityVerification()">üÜî Identity Verification</a>
              <a href="#" onclick="showBankVerification()">üè¶ Bank Verification</a>
            </div>
            <div class="dropdown-section">
              <h4>Account</h4>
              <a href="#" onclick="showOrderHistory()">üìã Order History</a>
              <a href="#" onclick="showChangeUsername()">‚úèÔ∏è Change Username</a>
              <a href="#" onclick="showUploadAvatar()">üñºÔ∏è Upload Avatar</a>
            </div>
            <div class="dropdown-section">
              <h4>Credits</h4>
              <div class="credit-display">Credits: <span id="creditBalance">5</span></div>
            </div>
            <div class="dropdown-section admin-section" id="adminSection" style="display: none;">
              <h4>üîß Admin Tools</h4>
              <a href="#" onclick="showAdminDashboard()">üìä Admin Dashboard</a>
              <a href="#" onclick="showUserManagement()">üë• User Management</a>
              <a href="#" onclick="showChatMonitoring()">üí¨ Chat Monitoring</a>
              <a href="#" onclick="showDeviceManagement()">üì± Device Management</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <h1 class="welcome-title">Discover Nearby Items</h1>
      <p class="welcome-subtitle">Swipe, bid, and find amazing deals in your area</p>
      <div class="location-info">
        üìç <span id="userLocation">Detecting your location...</span>
      </div>
    </section>

    <!-- Filters -->
    <section class="filters">
      <button class="filter-btn active" data-filter="all">All Items</button>
      <button class="filter-btn" data-filter="electronics">üì± Electronics</button>
      <button class="filter-btn" data-filter="clothing">üëï Clothing</button>
      <button class="filter-btn" data-filter="home">üè† Home & Garden</button>
      <button class="filter-btn" data-filter="sports">‚öΩ Sports</button>
      <button class="filter-btn" data-filter="books">üìö Books</button>
    </section>

    <!-- Items Container -->
    <section class="items-container" id="itemsContainer">
      <!-- Items will be loaded here -->
    </section>

    <!-- Loading State -->
    <div class="loading" id="loadingState" style="display: none;">
      <div class="spinner"></div>
    </div>
  </main>

  <!-- Floating Action Button -->
  <button class="fab" onclick="showAddItemModal()">+</button>

  <!-- Upload Item Modal -->
  <div id="uploadModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üì§ Add New Item</h2>
        <button class="close-btn" onclick="closeUploadModal()">&times;</button>
      </div>
      
      <form id="uploadForm" class="upload-form">
        <div class="form-group">
          <label for="itemTitle">Item Title *</label>
          <input type="text" id="itemTitle" name="title" required placeholder="e.g., iPhone 15 Pro Max">
        </div>
        
        <div class="form-group">
          <label for="itemDescription">Description *</label>
          <textarea id="itemDescription" name="description" required rows="3" placeholder="Describe your item in detail..."></textarea>
        </div>
        
        <div class="form-group">
          <label for="itemPrice">Price ($) *</label>
          <input type="number" id="itemPrice" name="price" required min="0.01" step="0.01" placeholder="0.00">
        </div>
        
        <div class="form-group">
          <label for="itemCategory">Category *</label>
          <select id="itemCategory" name="category" required>
            <option value="">Select a category</option>
            <option value="electronics">üì± Electronics</option>
            <option value="clothing">üëï Clothing</option>
            <option value="home">üè† Home & Garden</option>
            <option value="sports">‚öΩ Sports</option>
            <option value="books">üìö Books</option>
            <option value="other">üîß Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="itemImage">Item Image</label>
          <div class="image-upload-area" id="imageUploadArea">
            <input type="file" id="itemImage" name="image" accept="image/*" style="display: none;">
            <div class="upload-placeholder" onclick="document.getElementById('itemImage').click()">
              <div class="upload-icon">üì∑</div>
              <p>Click to upload image</p>
              <small>JPG, PNG, GIF up to 5MB</small>
            </div>
            <div class="image-preview" id="imagePreview" style="display: none;">
              <img id="previewImg" src="" alt="Preview">
              <button type="button" class="remove-image" onclick="removeImage()">√ó</button>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="auctionDuration">Auction Duration</label>
          <select id="auctionDuration" name="duration">
            <option value="24">24 hours</option>
            <option value="48">48 hours</option>
            <option value="72">72 hours</option>
            <option value="168">1 week</option>
          </select>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeUploadModal()">Cancel</button>
          <button type="submit" class="btn-submit">üöÄ List Item</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Real product data with 24-hour countdowns and scraped information
    const sampleItems = [
      {
        id: 1,
        title: "iPhone 15 Pro Max 256GB",
        description: "Apple iPhone 15 Pro Max with Titanium design, A17 Pro chip, 48MP camera system, and USB-C. Space Black color, factory sealed with warranty. Perfect condition, never used.",
        price: 899,
        distance: "0.3 miles",
        category: "electronics",
        image: "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-pro-finish-select-202309-6-7inch-naturaltitanium?wid=5120&hei=3280&fmt=p-jpg&qlt=80&.v=1693009279823",
        badge: "New",
        currentBids: 12,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.8/5 stars (2,847 reviews)",
        seller: "TechDeals Pro",
        condition: "Brand New",
        warranty: "1 Year Apple Warranty"
      },
      {
        id: 2,
        title: "Nike Air Jordan 1 Retro High",
        description: "Classic Air Jordan 1 Retro High in Bred colorway, size 10.5. Authentic Nike product, worn once for photos only. Includes original box and tags. Perfect for collectors or daily wear.",
        price: 120,
        distance: "0.7 miles",
        category: "clothing",
        image: "https://static.nike.com/a/images/t_PDP_1728_v1/f_auto,q_auto:eco/b7d9211c-26e7-431a-ac24-b0540fb3c00f/air-jordan-1-retro-high-og-shoes-Pz6fT9.png",
        badge: "Popular",
        currentBids: 8,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.7/5 stars (1,234 reviews)",
        seller: "SneakerHead",
        condition: "Like New",
        warranty: "30 Day Return"
      },
      {
        id: 3,
        title: "MacBook Pro 14-inch M3",
        description: "Apple MacBook Pro 14-inch with M3 chip, 16GB unified memory, 512GB SSD. Space Gray finish, perfect for professionals. Includes charger and original packaging. Excellent condition.",
        price: 1599,
        distance: "1.2 miles",
        category: "electronics",
        image: "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/mbp14-spacegray-select-202310?wid=904&hei=840&fmt=jpeg&qlt=90&.v=1697311050000",
        badge: "Hot",
        currentBids: 25,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.9/5 stars (3,156 reviews)",
        seller: "Apple Certified",
        condition: "Excellent",
        warranty: "1 Year Apple Care"
      },
      {
        id: 4,
        title: "Vintage Leather Motorcycle Jacket",
        description: "Authentic vintage leather motorcycle jacket, size Medium. Genuine leather construction, classic biker style. Great condition with minor wear that adds character. Perfect for fall and winter.",
        price: 85,
        distance: "0.5 miles",
        category: "clothing",
        image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=500&h=500&fit=crop&crop=center",
        badge: "Vintage",
        currentBids: 5,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.6/5 stars (89 reviews)",
        seller: "Vintage Finds",
        condition: "Good",
        warranty: "No Warranty"
      },
      {
        id: 5,
        title: "Secretlab Titan Evo Gaming Chair",
        description: "Secretlab Titan Evo 2022 Series gaming chair in Stealth color. Ergonomic design with lumbar support, RGB lighting, and premium materials. Barely used, like new condition.",
        price: 200,
        distance: "1.8 miles",
        category: "home",
        image: "https://secretlabcdn.com/cdn-cgi/image/width=1920,quality=75,format=auto/https://cdn.secretlab.co/americas/wp-content/uploads/2022/08/11100000_Stealth_01.png",
        badge: "Deal",
        currentBids: 15,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.8/5 stars (2,341 reviews)",
        seller: "Gaming Gear Pro",
        condition: "Like New",
        warranty: "2 Year Secretlab"
      },
      {
        id: 6,
        title: "Spalding NBA Portable Basketball Hoop",
        description: "Spalding NBA Portable Basketball System with 44-inch backboard. Adjustable height from 7.5 to 10 feet, professional-grade construction. Perfect for driveway or park use.",
        price: 150,
        distance: "2.1 miles",
        category: "sports",
        image: "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=500&h=500&fit=crop&crop=center",
        badge: "Sport",
        currentBids: 3,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.5/5 stars (567 reviews)",
        seller: "Sports Central",
        condition: "Good",
        warranty: "90 Day Parts"
      },
      {
        id: 7,
        title: "Sony WH-1000XM5 Noise Canceling Headphones",
        description: "Sony WH-1000XM5 wireless noise canceling headphones in Black. Industry-leading noise cancellation, 30-hour battery life, premium sound quality. Includes case and cables.",
        price: 280,
        distance: "0.9 miles",
        category: "electronics",
        image: "https://m.media-amazon.com/images/I/71o8Q5XJS5L._AC_SL1500_.jpg",
        badge: "Premium",
        currentBids: 18,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.8/5 stars (4,523 reviews)",
        seller: "Audio Excellence",
        condition: "Excellent",
        warranty: "1 Year Sony"
      },
      {
        id: 8,
        title: "Nike Air Force 1 '07 White",
        description: "Classic Nike Air Force 1 '07 in White, size 9. Timeless design, premium leather construction. Worn a few times, excellent condition. Includes original box and laces.",
        price: 75,
        distance: "1.4 miles",
        category: "clothing",
        image: "https://static.nike.com/a/images/t_PDP_1728_v1/f_auto,q_auto:eco/b7d9211c-26e7-431a-ac24-b0540fb3c00f/air-force-1-07-shoes-WrLlWX.png",
        badge: "Classic",
        currentBids: 7,
        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
        reviews: "4.6/5 stars (2,891 reviews)",
        seller: "Sneaker Vault",
        condition: "Very Good",
        warranty: "30 Day Return"
      }
    ];

    let currentFilter = 'all';
    let userLocation = null;
    let userCredits = 5; // Starting credits for new users

    // Initialize the app
    async function initApp() {
      console.log('üöÄ Initializing PacMac Marketplace Home...');
      
      // Check for OAuth success in URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const authStatus = urlParams.get('auth');
      const provider = urlParams.get('provider');
      
      if (authStatus === 'success') {
        console.log('‚úÖ OAuth authentication successful, provider:', provider);
        
        // Get user info from server to get actual Google name
        try {
          const userResponse = await fetch('/auth/user', {
            credentials: 'include'
          });
          const userData = await userResponse.json();
          
          if (userData.success && userData.user) {
            // Use actual user data from Google
            const oauthUser = {
              id: userData.user.id || 'oauth-user-' + Date.now(),
              name: userData.user.name || userData.user.displayName || 'Google User',
              email: userData.user.email || 'user@google.com',
              avatar: userData.user.avatar || userData.user.photos?.[0]?.value || 
                `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.user.name || 'Google User')}&background=3b82f6&color=fff`,
              ageVerified: true,
              identityVerified: false,
              totalEarnings: 0,
              isOAuth: true,
              provider: provider
            };
            
            // Store in localStorage to maintain login state
            localStorage.setItem('oauthUser', JSON.stringify(oauthUser));
            
            // Update UI immediately
            updateUserInfo(oauthUser);
            
            // Show success notification with user's name
            showNotification(`Welcome back, ${oauthUser.name}! üéâ`, 'success');
          } else {
            // Fallback if server data not available
            const oauthUser = {
              id: 'oauth-user-' + Date.now(),
              name: 'Google User',
              email: 'user@google.com',
              avatar: 'https://ui-avatars.com/api/?name=Google+User&background=3b82f6&color=fff',
              ageVerified: true,
              identityVerified: false,
              totalEarnings: 0,
              isOAuth: true,
              provider: provider
            };
            
            localStorage.setItem('oauthUser', JSON.stringify(oauthUser));
            updateUserInfo(oauthUser);
            showNotification('Successfully signed in! Welcome to PacMac Marketplace!', 'success');
          }
        } catch (error) {
          console.error('Error fetching user data:', error);
          // Fallback user creation
          const oauthUser = {
            id: 'oauth-user-' + Date.now(),
            name: 'Google User',
            email: 'user@google.com',
            avatar: 'https://ui-avatars.com/api/?name=Google+User&background=3b82f6&color=fff',
            ageVerified: true,
            identityVerified: false,
            totalEarnings: 0,
            isOAuth: true,
            provider: provider
          };
          
          localStorage.setItem('oauthUser', JSON.stringify(oauthUser));
          updateUserInfo(oauthUser);
          showNotification('Successfully signed in! Welcome to PacMac Marketplace!', 'success');
        }
        
        // Clear URL parameters
        window.history.replaceState({}, document.title, window.location.pathname);
      }
      
      // Check authentication
      await checkAuthStatus();
      
      // Get user location
      await getUserLocation();
      
      // Load items
      loadItems();
      
      // Setup event listeners
      setupEventListeners();
      
      console.log('‚úÖ App initialized successfully');
    }

    // Check authentication status
    async function checkAuthStatus() {
      try {
        // Check for OAuth user first
        const oauthUser = localStorage.getItem('oauthUser');
        if (oauthUser) {
          const user = JSON.parse(oauthUser);
          updateUserInfo(user);
          return;
        }
        
        // Check for demo user
        const demoUser = localStorage.getItem('demoUser');
        if (demoUser) {
          const user = JSON.parse(demoUser);
          updateUserInfo(user);
          return;
        }

        // Check server authentication
        const response = await fetch('/auth/user', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success && data.user) {
          updateUserInfo(data.user);
        } else {
          // Redirect to login if not authenticated
          window.location.href = '/marketplace.html';
        }
      } catch (error) {
        console.error('Auth check error:', error);
        window.location.href = '/marketplace.html';
      }
    }

    // Update user info in header
    function updateUserInfo(user) {
      const userAvatar = document.getElementById('userAvatar');
      const userDisplayName = document.getElementById('userDisplayName');
      const adminSection = document.getElementById('adminSection');
      
      if (user.name) {
        userDisplayName.textContent = `Hello, ${user.name}`;
        userAvatar.textContent = user.name.charAt(0).toUpperCase();
      }
      
      if (user.avatar) {
        userAvatar.style.backgroundImage = `url(${user.avatar})`;
        userAvatar.style.backgroundSize = 'cover';
        userAvatar.style.backgroundPosition = 'center';
        userAvatar.textContent = '';
      }

      // Show admin section for admin users
      if (user.isAdmin || (user.email && user.email.endsWith('@pacmacmobile.com'))) {
        adminSection.style.display = 'block';
        console.log('üîß Admin user detected:', user.email);
      } else {
        adminSection.style.display = 'none';
      }

      // Update credit balance
      updateCreditDisplay();
    }

    // Update credit display
    function updateCreditDisplay() {
      const creditBalance = document.getElementById('creditBalance');
      if (creditBalance) {
        creditBalance.textContent = userCredits;
      }
    }

    // Credit management functions
    function addCredits(amount, reason) {
      userCredits += amount;
      updateCreditDisplay();
      showNotification(`+${amount} credits earned! ${reason}`, 'success');
    }

    function spendCredits(amount, reason) {
      if (userCredits >= amount) {
        userCredits -= amount;
        updateCreditDisplay();
        showNotification(`-${amount} credits spent for ${reason}`, 'info');
        return true;
      } else {
        showNotification(`Insufficient credits! You need ${amount} credits.`, 'error');
        return false;
      }
    }

    // Get user location
    async function getUserLocation() {
      const locationElement = document.getElementById('userLocation');
      
      if (navigator.geolocation) {
        try {
          const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject);
          });
          
          userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          
          // Get actual location using reverse geocoding
          try {
            const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${userLocation.lat}&longitude=${userLocation.lng}&localityLanguage=en`);
            const locationData = await response.json();
            
            if (locationData.city && locationData.principalSubdivision) {
              locationElement.textContent = `${locationData.city}, ${locationData.principalSubdivision}`;
            } else if (locationData.locality) {
              locationElement.textContent = locationData.locality;
            } else {
              locationElement.textContent = 'Your Location';
            }
          } catch (error) {
            console.error('Reverse geocoding error:', error);
            locationElement.textContent = 'Your Location';
          }
        } catch (error) {
          console.error('Geolocation error:', error);
          locationElement.textContent = 'Location access denied';
        }
      } else {
        locationElement.textContent = 'Location not supported';
      }
    }

    // Load items
    function loadItems() {
      const container = document.getElementById('itemsContainer');
      const loadingState = document.getElementById('loadingState');
      
      // Show loading
      container.innerHTML = '';
      loadingState.style.display = 'flex';
      
      // Simulate loading delay
      setTimeout(() => {
        const filteredItems = currentFilter === 'all' 
          ? sampleItems 
          : sampleItems.filter(item => item.category === currentFilter);
        
        renderItems(filteredItems);
        loadingState.style.display = 'none';
      }, 1000);
    }

    // Render items
    function renderItems(items) {
      const container = document.getElementById('itemsContainer');
      
      if (items.length === 0) {
        container.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; color: white; padding: 2rem;">
            <h3>No items found</h3>
            <p>Try adjusting your filters or check back later!</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = items.map(item => `
        <div class="item-card" data-category="${item.category}" data-item-id="${item.id}">
          <div class="item-image">
            <img src="${item.image}" alt="${item.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="item-emoji" style="display: none;">${getCategoryEmoji(item.category)}</div>
            <div class="item-badge">${item.badge}</div>
          </div>
          <div class="item-content">
            <h3 class="item-title">${item.title}</h3>
            <p class="item-description">${item.description}</p>
            
            <div class="item-details">
              <div class="item-reviews">${item.reviews || 'No reviews yet'}</div>
              <div class="item-seller">Sold by: ${item.seller || 'Local Seller'}</div>
              <div class="item-condition">Condition: ${item.condition || 'Good'}</div>
              <div class="item-warranty">${item.warranty || 'No warranty'}</div>
            </div>
            
            <div class="item-meta">
              <div class="item-price">$${item.price}</div>
              <div class="item-distance">${item.distance}</div>
              <div class="item-bids">${item.currentBids} bids</div>
            </div>
            
            <div class="countdown-timer" data-end-time="${item.endTime.getTime()}">
              <div class="countdown-label">Time Left:</div>
              <div class="countdown-display" id="countdown-${item.id}">
                <span class="hours">00</span>:<span class="minutes">00</span>:<span class="seconds">00</span>
              </div>
            </div>
            
            <div class="item-actions">
              <button class="action-btn pass-btn" onclick="passItem(${item.id})">
                üëé Pass
              </button>
              <button class="action-btn bid-btn" onclick="bidOnItem(${item.id})">
                ‚ù§Ô∏è $1.00
              </button>
              <button class="action-btn heart-btn" onclick="bidFiveCents(${item.id})">
                ‚úÖ Bid $0.05
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Setup event listeners
    function setupEventListeners() {
      // Filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          // Update active state
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          
          // Update filter and reload items
          currentFilter = e.target.dataset.filter;
          loadItems();
        });
      });
    }

    // Item actions
    function passItem(itemId) {
      console.log('Passing item:', itemId);
      // Remove item from view
      const itemCard = document.querySelector(`[data-category]`);
      if (itemCard) {
        itemCard.style.transform = 'translateX(-100%)';
        itemCard.style.opacity = '0';
        setTimeout(() => {
          itemCard.remove();
        }, 300);
      }
    }

    function bidOnItem(itemId) {
      console.log('Bidding $1.00 on item:', itemId);
      // Show bid confirmation with Stripe fee breakdown
      const bidAmount = 1.00;
      const flatFee = 3.00;
      const percentageFee = bidAmount * 0.03;
      const totalFee = flatFee + percentageFee;
      const totalAmount = bidAmount + totalFee;
      
      alert(`Bid placed! $${bidAmount.toFixed(2)} bid added to this item.\n\nStripe fees:\n- Flat fee: $${flatFee.toFixed(2)}\n- 3% of bid: $${percentageFee.toFixed(2)}\n- Total charged: $${totalAmount.toFixed(2)}`);
    }

    function bidFiveCents(itemId) {
      console.log('Bidding $0.05 on item:', itemId);
      // Show bid confirmation with Stripe fee breakdown
      const bidAmount = 0.05;
      const flatFee = 3.00;
      const percentageFee = bidAmount * 0.03;
      const totalFee = flatFee + percentageFee;
      const totalAmount = bidAmount + totalFee;
      
      alert(`Bid placed! $${bidAmount.toFixed(2)} bid added to this item.\n\nStripe fees:\n- Flat fee: $${flatFee.toFixed(2)}\n- 3% of bid: $${percentageFee.toFixed(2)}\n- Total charged: $${totalAmount.toFixed(2)}`);
    }

    // Upload Modal Functions
    function showAddItemModal() {
      document.getElementById('uploadModal').style.display = 'flex';
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').style.display = 'none';
      document.body.style.overflow = 'auto'; // Restore scrolling
      resetUploadForm();
    }

    function resetUploadForm() {
      document.getElementById('uploadForm').reset();
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('imageUploadArea').querySelector('.upload-placeholder').style.display = 'block';
    }

    // Image upload handling
    document.getElementById('itemImage').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        // Validate file size (5MB limit)
        if (file.size > 5 * 1024 * 1024) {
          alert('Image size must be less than 5MB');
          return;
        }

        // Validate file type
        if (!file.type.startsWith('image/')) {
          alert('Please select a valid image file');
          return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('previewImg').src = e.target.result;
          document.getElementById('imagePreview').style.display = 'block';
          document.getElementById('imageUploadArea').querySelector('.upload-placeholder').style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    });

    function removeImage() {
      document.getElementById('itemImage').value = '';
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('imageUploadArea').querySelector('.upload-placeholder').style.display = 'block';
    }

    // Form submission
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.querySelector('.btn-submit');
      const originalText = submitBtn.textContent;
      
      // Disable submit button and show loading
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Listing Item...';
      
      try {
        const formData = new FormData(this);
        
        // Get form values
        const itemData = {
          title: formData.get('title'),
          description: formData.get('description'),
          price: parseFloat(formData.get('price')),
          category: formData.get('category'),
          duration: parseInt(formData.get('duration')),
          image: formData.get('image')
        };

        // Validate required fields
        if (!itemData.title || !itemData.description || !itemData.price || !itemData.category) {
          throw new Error('Please fill in all required fields');
        }

        if (itemData.price <= 0) {
          throw new Error('Price must be greater than $0');
        }

        // Create new item with countdown timer
        const newItem = {
          id: Date.now(), // Use timestamp as unique ID
          title: itemData.title,
          description: itemData.description,
          price: itemData.price,
          distance: '0.0 miles', // User's own item
          category: itemData.category,
          image: itemData.image ? 'üì∑' : getCategoryEmoji(itemData.category),
          badge: 'New',
          currentBids: 0,
          endTime: new Date(Date.now() + itemData.duration * 60 * 60 * 1000) // Convert hours to milliseconds
        };

        // Add to sample items array (in a real app, this would be sent to server)
        sampleItems.unshift(newItem); // Add to beginning of array

        // Show success message
        showNotification(`üéâ "${newItem.title}" listed successfully!`, 'success');
        
        // Close modal and refresh items
        closeUploadModal();
        loadItems(); // Reload items to show the new one

      } catch (error) {
        console.error('Upload error:', error);
        showNotification(`‚ùå Error: ${error.message}`, 'error');
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Helper function to get category emoji
    function getCategoryEmoji(category) {
      const emojis = {
        electronics: 'üì±',
        clothing: 'üëï',
        home: 'üè†',
        sports: '‚öΩ',
        books: 'üìö',
        other: 'üîß'
      };
      return emojis[category] || 'üì¶';
    }

    // Close modal when clicking outside
    document.getElementById('uploadModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeUploadModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('uploadModal').style.display === 'flex') {
        closeUploadModal();
      }
    });

    // Show notification
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--gradient-2)' : 'var(--gradient-1)'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 15px;
        box-shadow: var(--shadow-hover);
        z-index: 1000;
        font-weight: 600;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      
      // Add to page
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // Countdown timer functionality
    function startCountdownTimers() {
      setInterval(() => {
        document.querySelectorAll('.countdown-timer').forEach(timer => {
          const endTime = parseInt(timer.dataset.endTime);
          const now = new Date().getTime();
          const timeLeft = endTime - now;
          
          if (timeLeft > 0) {
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            const display = timer.querySelector('.countdown-display');
            if (display) {
              display.innerHTML = `
                <span class="hours">${hours.toString().padStart(2, '0')}</span>:
                <span class="minutes">${minutes.toString().padStart(2, '0')}</span>:
                <span class="seconds">${seconds.toString().padStart(2, '0')}</span>
              `;
            }
          } else {
            // Time expired
            timer.innerHTML = '<div class="expired">‚è∞ Auction Ended</div>';
            timer.style.color = '#ff4757';
            timer.style.fontWeight = 'bold';
          }
        });
      }, 1000);
    }

    // Mobile swipe functionality
    let touchStartX = 0;
    let touchStartY = 0;
    let touchEndX = 0;
    let touchEndY = 0;

    function handleTouchStart(e) {
      touchStartX = e.changedTouches[0].screenX;
      touchStartY = e.changedTouches[0].screenY;
    }

    function handleTouchEnd(e) {
      touchEndX = e.changedTouches[0].screenX;
      touchEndY = e.changedTouches[0].screenY;
      handleSwipe();
    }

    function handleSwipe() {
      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      const minSwipeDistance = 50;

      // Only process horizontal swipes (ignore vertical scrolling)
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
        const currentItem = document.querySelector('.item-card:not([style*="display: none"])');
        if (currentItem) {
          // Get item ID from data attribute
          const itemId = parseInt(currentItem.dataset.itemId) || 1;
          
          if (deltaX > 0) {
            // Swipe right - bid 5 cents
            console.log('Swipe right detected - bidding 5 cents');
            bidFiveCents(itemId);
          } else {
            // Swipe left - pass
            console.log('Swipe left detected - passing');
            passItem(itemId);
          }
        }
      }
    }

    // Add touch event listeners
    function addSwipeListeners() {
      document.addEventListener('touchstart', handleTouchStart, { passive: true });
      document.addEventListener('touchend', handleTouchEnd, { passive: true });
    }

    // User Dropdown Functions
    function toggleUserMenu() {
      const menu = document.getElementById('userDropdownMenu');
      const btn = document.querySelector('.user-menu-btn');
      
      menu.classList.toggle('show');
      btn.classList.toggle('active');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      const dropdown = document.querySelector('.user-dropdown');
      if (!dropdown.contains(e.target)) {
        const menu = document.getElementById('userDropdownMenu');
        const btn = document.querySelector('.user-menu-btn');
        menu.classList.remove('show');
        btn.classList.remove('active');
      }
    });

    // Verification Modal Functions
    function showAddressVerification() {
      const address = prompt('üìç Address Verification\n\nEnter your full address (Street, City, State, ZIP):\nExample: 123 Main St, New York, NY, 10001');
      
      if (address && address.trim()) {
        const addressParts = address.split(',').map(part => part.trim());
        if (addressParts.length >= 4) {
          const [street, city, state, zipcode] = addressParts;
          
          fetch('/api/verification/address', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({ street, city, state, zipcode })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success && data.verified) {
              if (data.demo) {
                showNotification('üîß Demo Mode: Address verification service not configured. This would normally verify with USPS.', 'info');
                setTimeout(() => {
                  showNotification('‚úÖ Demo: Address verified successfully!', 'success');
                }, 1000);
              } else {
                showNotification('‚úÖ Address verified successfully!', 'success');
              }
            } else {
              showNotification('‚ùå Address verification failed. Please check your address.', 'error');
            }
          })
          .catch(error => {
            console.error('Address verification error:', error);
            // Fallback to demo mode if service is unavailable
            showNotification('üîß Demo Mode: Address verification service not configured. This would normally verify with USPS.', 'info');
            setTimeout(() => {
              showNotification('‚úÖ Demo: Address verified successfully!', 'success');
            }, 1000);
          });
        } else {
          showNotification('‚ùå Please enter a complete address with street, city, state, and ZIP code.', 'error');
        }
      }
    }

    function showIdentityVerification() {
      if (confirm('üÜî Identity Verification\n\nThis will redirect you to our secure ID verification service.\n\nYou will need:\n‚Ä¢ Government-issued photo ID\n‚Ä¢ Selfie with ID\n‚Ä¢ Last 4 digits of SSN\n\nContinue?')) {
        fetch('/api/verification/id/initiate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success && data.redirectUrl) {
            if (data.demo) {
              showNotification('üîß Demo Mode: ID verification service not configured. This would normally redirect to Jumio for verification.', 'info');
              // Simulate successful verification after 3 seconds
              setTimeout(() => {
                showNotification('‚úÖ Demo: ID verification completed successfully!', 'success');
              }, 3000);
            } else {
              window.open(data.redirectUrl, '_blank');
              showNotification('üîÑ Redirecting to ID verification...', 'info');
            }
          } else {
            showNotification('‚ùå ID verification service unavailable. Please try again later.', 'error');
          }
        })
        .catch(error => {
          console.error('ID verification error:', error);
          // Fallback to demo mode if service is unavailable
          showNotification('üîß Demo Mode: ID verification service not configured. This would normally redirect to Jumio for verification.', 'info');
          setTimeout(() => {
            showNotification('‚úÖ Demo: ID verification completed successfully!', 'success');
          }, 3000);
        });
      }
    }

    function showBankVerification() {
      if (confirm('üè¶ Bank Verification\n\nThis will connect you to Plaid for secure bank account verification.\n\nYour bank account will be verified for:\n‚Ä¢ Secure payouts\n‚Ä¢ Transaction processing\n‚Ä¢ Fraud prevention\n\nContinue?')) {
        fetch('/api/verification/bank/create-link-token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success && data.linkToken) {
            if (data.demo) {
              showNotification('üîß Demo Mode: Plaid service not configured. This would normally connect to your bank account.', 'info');
              // Simulate bank verification success
              setTimeout(() => {
                showNotification('‚úÖ Demo: Bank account verified successfully!', 'success');
              }, 2000);
            } else {
              // In a real implementation, you would use Plaid Link
              showNotification('üîÑ Bank verification initiated. Plaid integration ready!', 'info');
              
              // Simulate bank verification success
              setTimeout(() => {
                showNotification('‚úÖ Bank account verified successfully!', 'success');
              }, 2000);
            }
          } else {
            showNotification('‚ùå Bank verification service unavailable. Please try again later.', 'error');
          }
        })
        .catch(error => {
          console.error('Bank verification error:', error);
          // Fallback to demo mode if service is unavailable
          showNotification('üîß Demo Mode: Plaid service not configured. This would normally connect to your bank account.', 'info');
          setTimeout(() => {
            showNotification('‚úÖ Demo: Bank account verified successfully!', 'success');
          }, 2000);
        });
      }
    }

    function showOrderHistory() {
      alert('üìã Order History\n\nYour transaction history will be displayed here:\n‚Ä¢ Completed purchases\n‚Ä¢ Active bids\n‚Ä¢ Payment history\n‚Ä¢ Dispute records');
    }

    function showChangeUsername() {
      const newUsername = prompt('‚úèÔ∏è Change Username\n\nEnter your new username:');
      if (newUsername && newUsername.trim()) {
        document.getElementById('userDisplayName').textContent = `Hello, ${newUsername.trim()}`;
        showNotification(`Username updated to: ${newUsername.trim()}`, 'success');
      }
    }

    function showUploadAvatar() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const avatar = document.getElementById('userAvatar');
            avatar.style.backgroundImage = `url(${e.target.result})`;
            avatar.style.backgroundSize = 'cover';
            avatar.style.backgroundPosition = 'center';
            avatar.textContent = '';
            showNotification('Avatar uploaded successfully!', 'success');
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    // Admin Functions
    function showAdminDashboard() {
      fetch('/api/admin/dashboard', {
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const stats = data.stats;
          alert(`üìä Admin Dashboard\n\n` +
            `üë• Total Users: ${stats.totalUsers}\n` +
            `üö´ Suspended Users: ${stats.suspendedUsers}\n` +
            `üì± Banned Devices: ${stats.bannedDevices}\n` +
            `üí¨ Total Chats: ${stats.totalChats}\n\n` +
            `Recent Actions:\n${stats.recentActions.slice(0, 3).map(action => 
              `‚Ä¢ ${action.action} by ${action.adminId} at ${new Date(action.timestamp).toLocaleString()}`
            ).join('\n')}`);
        } else {
          showNotification('‚ùå Failed to load admin dashboard', 'error');
        }
      })
      .catch(error => {
        console.error('Admin dashboard error:', error);
        showNotification('‚ùå Admin dashboard unavailable', 'error');
      });
    }

    function showUserManagement() {
      fetch('/api/admin/users', {
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const users = data.users;
          const userList = users.slice(0, 10).map(user => 
            `${user.name} (${user.email}) - ${user.isSuspended ? 'üö´ Suspended' : '‚úÖ Active'}`
          ).join('\n');
          
          const action = prompt(`üë• User Management\n\nRecent Users:\n${userList}\n\nEnter user email to manage:`);
          if (action) {
            const targetUser = users.find(u => u.email === action);
            if (targetUser) {
              showUserActions(targetUser);
            } else {
              showNotification('‚ùå User not found', 'error');
            }
          }
        } else {
          showNotification('‚ùå Failed to load users', 'error');
        }
      })
      .catch(error => {
        console.error('User management error:', error);
        showNotification('‚ùå User management unavailable', 'error');
      });
    }

    function showUserActions(user) {
      const actions = [
        '1. Suspend User',
        '2. Unsuspend User', 
        '3. Kick User',
        '4. View Details'
      ].join('\n');
      
      const choice = prompt(`üë§ User Actions for ${user.name}\n\n${actions}\n\nEnter choice (1-4):`);
      
      switch(choice) {
        case '1':
          const reason = prompt('Enter suspension reason:');
          if (reason) {
            suspendUser(user.id, reason);
          }
          break;
        case '2':
          unsuspendUser(user.id);
          break;
        case '3':
          const kickReason = prompt('Enter kick reason:');
          if (kickReason) {
            kickUser(user.id, kickReason);
          }
          break;
        case '4':
          alert(`üë§ User Details\n\n` +
            `Name: ${user.name}\n` +
            `Email: ${user.email}\n` +
            `Admin: ${user.isAdmin ? 'Yes' : 'No'}\n` +
            `Suspended: ${user.isSuspended ? 'Yes' : 'No'}\n` +
            `Device ID: ${user.deviceId || 'Not set'}\n` +
            `Last Login: ${user.lastLogin}\n` +
            `Total Earnings: $${user.totalEarnings}`);
          break;
      }
    }

    function suspendUser(userId, reason) {
      fetch(`/api/admin/users/${userId}/suspend`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ reason, duration: 'indefinite' })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification('‚úÖ User suspended successfully', 'success');
        } else {
          showNotification('‚ùå Failed to suspend user', 'error');
        }
      })
      .catch(error => {
        console.error('Suspend user error:', error);
        showNotification('‚ùå Failed to suspend user', 'error');
      });
    }

    function unsuspendUser(userId) {
      fetch(`/api/admin/users/${userId}/unsuspend`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification('‚úÖ User unsuspended successfully', 'success');
        } else {
          showNotification('‚ùå Failed to unsuspend user', 'error');
        }
      })
      .catch(error => {
        console.error('Unsuspend user error:', error);
        showNotification('‚ùå Failed to unsuspend user', 'error');
      });
    }

    function kickUser(userId, reason) {
      fetch(`/api/admin/users/${userId}/kick`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ reason })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification('‚úÖ User kicked successfully', 'success');
        } else {
          showNotification('‚ùå Failed to kick user', 'error');
        }
      })
      .catch(error => {
        console.error('Kick user error:', error);
        showNotification('‚ùå Failed to kick user', 'error');
      });
    }

    function showChatMonitoring() {
      fetch('/api/admin/chats', {
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const chats = data.chats;
          if (chats.length === 0) {
            alert('üí¨ Chat Monitoring\n\nNo chats found.');
          } else {
            const chatList = chats.slice(0, 10).map(chat => 
              `Chat ${chat.id}: ${chat.participants?.join(', ') || 'Unknown participants'}`
            ).join('\n');
            
            const chatId = prompt(`üí¨ Chat Monitoring\n\nRecent Chats:\n${chatList}\n\nEnter chat ID to view:`);
            if (chatId) {
              viewChat(chatId);
            }
          }
        } else {
          showNotification('‚ùå Failed to load chats', 'error');
        }
      })
      .catch(error => {
        console.error('Chat monitoring error:', error);
        showNotification('‚ùå Chat monitoring unavailable', 'error');
      });
    }

    function viewChat(chatId) {
      fetch(`/api/admin/chats/${chatId}`, {
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const chat = data.chat;
          alert(`üí¨ Chat Details\n\n` +
            `Chat ID: ${chat.id}\n` +
            `Participants: ${chat.participants?.join(', ') || 'Unknown'}\n` +
            `Messages: ${chat.messages?.length || 0}\n` +
            `Created: ${chat.createdAt || 'Unknown'}\n` +
            `Last Activity: ${chat.lastActivity || 'Unknown'}`);
        } else {
          showNotification('‚ùå Chat not found', 'error');
        }
      })
      .catch(error => {
        console.error('View chat error:', error);
        showNotification('‚ùå Failed to load chat', 'error');
      });
    }

    function showDeviceManagement() {
      const deviceId = prompt('üì± Device Management\n\nEnter device ID to manage:');
      if (deviceId) {
        const action = prompt('Choose action:\n1. Ban Device\n2. Unban Device\n3. View Details\n\nEnter choice (1-3):');
        
        switch(action) {
          case '1':
            const reason = prompt('Enter ban reason:');
            if (reason) {
              banDevice(deviceId, reason);
            }
            break;
          case '2':
            unbanDevice(deviceId);
            break;
          case '3':
            alert(`üì± Device Details\n\nDevice ID: ${deviceId}\nStatus: Check server logs for details`);
            break;
        }
      }
    }

    function banDevice(deviceId, reason) {
      fetch(`/api/admin/devices/${deviceId}/ban`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ reason })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification('‚úÖ Device banned successfully', 'success');
        } else {
          showNotification('‚ùå Failed to ban device', 'error');
        }
      })
      .catch(error => {
        console.error('Ban device error:', error);
        showNotification('‚ùå Failed to ban device', 'error');
      });
    }

    function unbanDevice(deviceId) {
      fetch(`/api/admin/devices/${deviceId}/unban`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification('‚úÖ Device unbanned successfully', 'success');
        } else {
          showNotification('‚ùå Failed to unban device', 'error');
        }
      })
      .catch(error => {
        console.error('Unban device error:', error);
        showNotification('‚ùå Failed to unban device', 'error');
      });
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initApp();
      startCountdownTimers();
      addSwipeListeners();
    });
  </script>
</body>
</html>
