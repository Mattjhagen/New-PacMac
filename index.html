<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacMac Mobile - Inventory Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #007AFF;
            margin-bottom: 10px;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .tab-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1d1d1f;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007AFF;
        }
        
        .image-upload {
            border: 2px dashed #007AFF;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .image-upload:hover {
            background: #f0f4ff;
        }
        
        .image-upload.dragover {
            background: #e6f2ff;
            border-color: #0056b3;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #8e8e93;
        }
        
        .btn-secondary:hover {
            background: #6d6d70;
        }
        
        .btn-danger {
            background: #ff3b30;
        }
        
        .btn-danger:hover {
            background: #d70015;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .inventory-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .inventory-card:hover {
            transform: translateY(-2px);
        }
        
        .inventory-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .inventory-card h3 {
            margin-bottom: 10px;
            color: #1d1d1f;
        }
        
        .inventory-card .price {
            font-size: 18px;
            font-weight: 600;
            color: #007AFF;
            margin-bottom: 10px;
        }
        
        .inventory-card .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .tag {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #007AFF;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #8e8e93;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication Section -->
        <div id="auth-section" class="header" style="text-align: center;">
            <h1>üì± PacMac Mobile Inventory Admin</h1>
            <p>Please sign in to manage your product inventory, pricing, and images</p>
            <div style="margin-top: 20px;">
                <button id="btn-login" class="btn" onclick="login()" style="margin-right: 10px;">üîê Log in with Google</button>
                <button id="btn-logout" class="btn btn-secondary" onclick="logout()" style="display: none;">üö™ Log out</button>
            </div>
            <div id="user-info" style="margin-top: 15px; display: none;">
                <p>Welcome, <span id="user-name"></span>!</p>
            </div>
        </div>

        <!-- Main Admin Content (hidden until authenticated) -->
        <div id="admin-content" style="display: none;">
        
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="showTab('add-product')">Add Product</button>
            <button class="tab-btn" onclick="showTab('manage-inventory')">Manage Inventory</button>
            <button class="tab-btn" onclick="showTab('export-import')">Export/Import</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-products">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-value">$0</div>
                    <div class="stat-label">Total Inventory Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="new-products">0</div>
                    <div class="stat-label">New This Week</div>
                </div>
            </div>
            
            <div class="form-section">
                <h2>Quick Actions</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="showTab('add-product')">Add New Product</button>
                    <button class="btn btn-secondary" onclick="exportInventory()">Export Inventory</button>
                    <button class="btn btn-secondary" onclick="importInventory()">Import Inventory</button>
                    <button class="btn btn-secondary" onclick="syncToMainSite()">Sync to Main Site</button>
                </div>
            </div>
        </div>
        
        <!-- Add Product Tab -->
        <div id="add-product" class="tab-content">
            <div class="form-section">
                <h2>Add New Product</h2>
                <form id="product-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="product-name">Product Name *</label>
                            <input type="text" id="product-name" required placeholder="e.g., iPhone 15 Pro Max">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-id">Product ID *</label>
                            <input type="text" id="product-id" required placeholder="e.g., pm-iphone15promax">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-price">Price *</label>
                            <input type="number" id="product-price" step="0.01" required placeholder="999.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-category">Category</label>
                            <select id="product-category">
                                <option value="main">Main Product</option>
                                <option value="refurbished">Refurbished</option>
                                <option value="accessory">Accessory</option>
                            </select>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-description">Description</label>
                            <textarea id="product-description" rows="3" placeholder="Brief product description"></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-specs">Specifications (JSON format)</label>
                            <textarea id="product-specs" rows="4" placeholder='{"storage": "128GB", "color": "Space Black", "condition": "Like New"}'></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-tags">Tags (comma-separated)</label>
                            <input type="text" id="product-tags" placeholder="iPhone, 128GB, Space Black, Like New">
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Product Image</label>
                            <div class="image-upload" id="image-upload" onclick="document.getElementById('image-input').click()">
                                <div id="upload-text">
                                    <p>üì∑ Click to upload image or drag & drop</p>
                                    <p style="font-size: 14px; color: #8e8e93;">Recommended: 400x400px, JPG/PNG</p>
                                </div>
                                <img id="image-preview" class="image-preview" style="display: none;">
                                <input type="file" id="image-input" accept="image/*" style="display: none;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">Add Product</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Manage Inventory Tab -->
        <div id="manage-inventory" class="tab-content">
            <div class="form-section">
                <h2>Current Inventory</h2>
                <div id="inventory-grid" class="inventory-grid">
                    <!-- Inventory items will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Export/Import Tab -->
        <div id="export-import" class="tab-content">
            <div class="form-section">
                <h2>Export/Import Inventory</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h3>Export Inventory</h3>
                        <p>Download your current inventory as a JSON file for backup or sharing.</p>
                        <button class="btn" onclick="exportInventory()">Export to JSON</button>
                    </div>
                    <div>
                        <h3>Import Inventory</h3>
                        <p>Upload a JSON file to restore or update your inventory.</p>
                        <input type="file" id="import-file" accept=".json" style="margin-bottom: 15px;">
                        <br>
                        <button class="btn btn-secondary" onclick="importInventory()">Import from JSON</button>
                    </div>
                </div>
                <div class="export-section">
                    <h3>Import from Wholesaler XLSX</h3>
                    <p>Upload your wholesaler's Excel file to automatically import inventory.</p>
                    <input type="file" id="xlsx-file" accept=".xlsx,.xls" style="margin-bottom: 15px;">
                    <br>
                    <button class="btn" onclick="importFromXLSX()">Import from XLSX</button>
                    <div id="xlsx-preview" class="hidden"></div>
                </div>
            </div>
        </div>
        </div> <!-- End admin-content -->
    </div>
    
    <!-- Google OAuth SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // OAuth Authentication System
        class AuthManager {
            constructor() {
                this.isAuthenticated = false;
                this.user = null;
                this.initializeAuth();
            }

            initializeAuth() {
                // Check if user is already authenticated
                const savedUser = localStorage.getItem('pmm-user');
                if (savedUser) {
                    this.user = JSON.parse(savedUser);
                    this.isAuthenticated = true;
                    this.showAuthenticatedState();
                } else {
                    this.showUnauthenticatedState();
                }

                // Initialize Google OAuth
                if (typeof google !== 'undefined') {
                    google.accounts.id.initialize({
                        client_id: 'YOUR_GOOGLE_CLIENT_ID', // Replace with your actual client ID
                        callback: this.handleCredentialResponse.bind(this),
                        auto_select: false,
                        cancel_on_tap_outside: true
                    });
                }
            }

            handleCredentialResponse(response) {
                // Decode the JWT token
                const responsePayload = this.decodeJwtResponse(response.credential);
                
                this.user = {
                    name: responsePayload.name,
                    email: responsePayload.email,
                    picture: responsePayload.picture,
                    sub: responsePayload.sub
                };

                this.isAuthenticated = true;
                localStorage.setItem('pmm-user', JSON.stringify(this.user));
                this.showAuthenticatedState();
            }

            decodeJwtResponse(token) {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            }

            showAuthenticatedState() {
                document.getElementById('btn-login').style.display = 'none';
                document.getElementById('btn-logout').style.display = 'inline-block';
                document.getElementById('user-info').style.display = 'block';
                document.getElementById('admin-content').style.display = 'block';
                document.getElementById('user-name').textContent = this.user.name;
                
                // Initialize inventory manager if not already done
                if (typeof inventoryManager === 'undefined') {
                    window.inventoryManager = new InventoryManager();
                } else {
                    // Update dashboard and inventory grid
                    inventoryManager.updateDashboard();
                    inventoryManager.loadInventoryGrid();
                }
            }

            showUnauthenticatedState() {
                document.getElementById('btn-login').style.display = 'inline-block';
                document.getElementById('btn-logout').style.display = 'none';
                document.getElementById('user-info').style.display = 'none';
                document.getElementById('admin-content').style.display = 'none';
            }

            logout() {
                this.isAuthenticated = false;
                this.user = null;
                localStorage.removeItem('pmm-user');
                this.showUnauthenticatedState();
                
                // Sign out from Google
                if (typeof google !== 'undefined') {
                    google.accounts.id.disableAutoSelect();
                }
            }
        }

        // Global authentication functions
        function login() {
            if (typeof google !== 'undefined') {
                google.accounts.id.prompt();
            } else {
                alert('Google OAuth is not loaded. Please refresh the page and try again.');
            }
        }

        function logout() {
            authManager.logout();
        }

        // Initialize authentication
        const authManager = new AuthManager();

        // Inventory Management System
        class InventoryManager {
            constructor() {
                this.inventory = this.loadInventory();
                this.initializeEventListeners();
                // Only update UI if user is authenticated
                if (authManager.isAuthenticated) {
                    this.updateDashboard();
                    this.loadInventoryGrid();
                }
            }
            
            loadInventory() {
                const saved = localStorage.getItem('pmm-inventory');
                if (saved) {
                    return JSON.parse(saved);
                }
                return [];
            }
            
            saveInventory() {
                localStorage.setItem('pmm-inventory', JSON.stringify(this.inventory));
                this.updateDashboard();
                this.loadInventoryGrid();
            }
            
            addProduct(productData) {
                const product = {
                    id: productData.id,
                    name: productData.name,
                    price: parseFloat(productData.price),
                    category: productData.category || 'main',
                    description: productData.description || '',
                    specs: this.parseSpecs(productData.specs),
                    tags: productData.tags ? productData.tags.split(',').map(t => t.trim()) : [],
                    img: productData.imageData || 'products/placeholder.jpg',
                    dateAdded: new Date().toISOString()
                };
                
                this.inventory.push(product);
                this.saveInventory();
                return product;
            }
            
            parseSpecs(specsString) {
                if (!specsString) return {};
                try {
                    return JSON.parse(specsString);
                } catch (e) {
                    // If not valid JSON, create a simple object
                    return { note: specsString };
                }
            }
            
            updateProduct(id, updates) {
                const index = this.inventory.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.inventory[index] = { ...this.inventory[index], ...updates };
                    this.saveInventory();
                }
            }
            
            deleteProduct(id) {
                this.inventory = this.inventory.filter(p => p.id !== id);
                this.saveInventory();
            }
            
            updateDashboard() {
                const totalProducts = this.inventory.length;
                const totalValue = this.inventory.reduce((sum, p) => sum + p.price, 0);
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                const newProducts = this.inventory.filter(p => new Date(p.dateAdded) > weekAgo).length;
                
                document.getElementById('total-products').textContent = totalProducts;
                document.getElementById('total-value').textContent = `$${totalValue.toLocaleString()}`;
                document.getElementById('new-products').textContent = newProducts;
            }
            
            loadInventoryGrid() {
                const grid = document.getElementById('inventory-grid');
                grid.innerHTML = '';
                
                this.inventory.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'inventory-card';
                    card.innerHTML = `
                        <img src="${product.img}" alt="${product.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><rect width=\'100\' height=\'100\' fill=\'%23f0f0f0\'/><text x=\'50\' y=\'50\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'>No Image</text></svg>'">
                        <h3>${product.name}</h3>
                        <div class="price">$${product.price.toFixed(2)}</div>
                        <div class="tags">
                            ${product.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary" onclick="inventoryManager.editProduct('${product.id}')">Edit</button>
                            <button class="btn btn-danger" onclick="inventoryManager.deleteProduct('${product.id}')">Delete</button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
            
            editProduct(id) {
                const product = this.inventory.find(p => p.id === id);
                if (product) {
                    // Populate form with product data
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-id').value = product.id;
                    document.getElementById('product-price').value = product.price;
                    document.getElementById('product-category').value = product.category;
                    document.getElementById('product-description').value = product.description;
                    document.getElementById('product-specs').value = JSON.stringify(product.specs, null, 2);
                    document.getElementById('product-tags').value = product.tags.join(', ');
                    
                    if (product.img && product.img.startsWith('data:')) {
                        document.getElementById('image-preview').src = product.img;
                        document.getElementById('image-preview').style.display = 'block';
                        document.getElementById('upload-text').style.display = 'none';
                    }
                    
                    showTab('add-product');
                }
            }
            
            initializeEventListeners() {
                // Form submission
                document.getElementById('product-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleFormSubmit();
                });
                
                // Image upload
                const imageInput = document.getElementById('image-input');
                const imageUpload = document.getElementById('image-upload');
                
                imageInput.addEventListener('change', (e) => {
                    this.handleImageUpload(e.target.files[0]);
                });
                
                // Drag and drop
                imageUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    imageUpload.classList.add('dragover');
                });
                
                imageUpload.addEventListener('dragleave', () => {
                    imageUpload.classList.remove('dragover');
                });
                
                imageUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    imageUpload.classList.remove('dragover');
                    this.handleImageUpload(e.dataTransfer.files[0]);
                });
            }
            
            handleFormSubmit() {
                const formData = {
                    name: document.getElementById('product-name').value,
                    id: document.getElementById('product-id').value,
                    price: document.getElementById('product-price').value,
                    category: document.getElementById('product-category').value,
                    description: document.getElementById('product-description').value,
                    specs: document.getElementById('product-specs').value,
                    tags: document.getElementById('product-tags').value,
                    imageData: document.getElementById('image-preview').src
                };
                
                // Check if editing existing product
                const existingIndex = this.inventory.findIndex(p => p.id === formData.id);
                
                if (existingIndex !== -1) {
                    this.updateProduct(formData.id, {
                        name: formData.name,
                        price: parseFloat(formData.price),
                        category: formData.category,
                        description: formData.description,
                        specs: this.parseSpecs(formData.specs),
                        tags: formData.tags ? formData.tags.split(',').map(t => t.trim()) : [],
                        img: formData.imageData
                    });
                    this.showAlert('Product updated successfully!', 'success');
                } else {
                    this.addProduct(formData);
                    this.showAlert('Product added successfully!', 'success');
                }
                
                this.clearForm();
            }
            
            handleImageUpload(file) {
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    this.showAlert('Please select a valid image file.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('image-preview').src = e.target.result;
                    document.getElementById('image-preview').style.display = 'block';
                    document.getElementById('upload-text').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
            
            clearForm() {
                document.getElementById('product-form').reset();
                document.getElementById('image-preview').style.display = 'none';
                document.getElementById('upload-text').style.display = 'block';
            }
            
            showAlert(message, type) {
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                
                const container = document.querySelector('.container');
                container.insertBefore(alert, container.firstChild);
                
                setTimeout(() => {
                    alert.remove();
                }, 3000);
            }
            
            exportInventory() {
                const dataStr = JSON.stringify(this.inventory, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `pmm-inventory-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
            }
            
            importInventory() {
                const fileInput = document.getElementById('import-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    this.showAlert('Please select a file to import.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (Array.isArray(importedData)) {
                            this.inventory = importedData;
                            this.saveInventory();
                            this.showAlert('Inventory imported successfully!', 'success');
                        } else {
                            this.showAlert('Invalid file format.', 'error');
                        }
                    } catch (error) {
                        this.showAlert('Error reading file: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            }
            
            syncToMainSite() {
                // Generate JavaScript code for main site
                const jsCode = this.generateProductsArrayCode();
                
                // Create a new window with the generated code
                const newWindow = window.open('', '_blank', 'width=800,height=600');
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Generated PRODUCTS Array</title>
                        <style>
                            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 20px; background: #f5f5f7; }
                            .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                            pre { background: #f8f9fa; padding: 20px; border-radius: 8px; overflow-x: auto; border: 1px solid #e5e5e7; }
                            .copy-btn { background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin: 15px 0; font-weight: 600; }
                            .copy-btn:hover { background: #0056b3; }
                            .instructions { background: #e6f2ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <h1>üì± Generated PRODUCTS Array</h1>
                            <div class="instructions">
                                <strong>Instructions:</strong><br>
                                1. Click "Copy to Clipboard" below<br>
                                2. Open your index.html file<br>
                                3. Find the PRODUCTS array (around line 400)<br>
                                4. Replace the entire PRODUCTS array with the copied code<br>
                                5. Save and deploy your site
                            </div>
                            
                            <button class="copy-btn" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
                            
                            <pre id="code-block">${jsCode}</pre>
                        </div>
                        
                        <scr' + 'ipt>
                            function copyToClipboard() {
                                const codeBlock = document.getElementById('code-block');
                                navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                                    alert('‚úÖ Code copied to clipboard!\\n\\nNow paste it into your index.html file to replace the PRODUCTS array.');
                                }).catch(err => {
                                    // Fallback for older browsers
                                    const textArea = document.createElement('textarea');
                                    textArea.value = codeBlock.textContent;
                                    document.body.appendChild(textArea);
                                    textArea.select();
                                    document.execCommand('copy');
                                    document.body.removeChild(textArea);
                                    alert('‚úÖ Code copied to clipboard!');
                                });
                            }
                        </scr' + 'ipt>
                    </body>
                    </html>
                `);
            }
            
            generateProductsArrayCode() {
                const markupPercentage = 22; // 22% markup
                
                const products = this.inventory.map(item => {
                    const priceWithMarkup = (item.price * (1 + markupPercentage / 100)).toFixed(2);
                    
                    return {
                        id: item.id,
                        name: item.name,
                        price: parseFloat(priceWithMarkup),
                        tags: item.tags || [],
                        img: item.img,
                        description: item.description || '',
                        specs: item.specs || {}
                    };
                });
                
                let jsCode = `const PRODUCTS = [\n`;
                
                products.forEach((product, index) => {
                    jsCode += `  {\n`;
                    jsCode += `    id: '${product.id}',\n`;
                    jsCode += `    name: '${product.name.replace(/'/g, "\\'")}',\n`;
                    jsCode += `    price: ${product.price},\n`;
                    jsCode += `    tags: [${product.tags.map(tag => `'${tag.replace(/'/g, "\\'")}'`).join(', ')}],\n`;
                    jsCode += `    img: '${product.img}',\n`;
                    jsCode += `    description: '${product.description.replace(/'/g, "\\'")}',\n`;
                    jsCode += `    specs: ${JSON.stringify(product.specs, null, 4).replace(/^/gm, '    ')}\n`;
                    jsCode += `  }${index < products.length - 1 ? ',' : ''}\n`;
                });
                
                jsCode += `];\n\n`;
                jsCode += `// Generated on ${new Date().toISOString()}\n`;
                jsCode += `// Total products: ${products.length}\n`;
                jsCode += `// Markup applied: ${markupPercentage}%\n`;
                
                return jsCode;
            }
        }
        
        // Global functions
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        function clearForm() {
            inventoryManager.clearForm();
        }
        
        function exportInventory() {
            inventoryManager.exportInventory();
        }
        
        function importInventory() {
            inventoryManager.importInventory();
        }
        
        function syncToMainSite() {
            inventoryManager.syncToMainSite();
        }

        function importFromXLSX() {
            const fileInput = document.getElementById('xlsx-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an XLSX file first.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // Get the first worksheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert to JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Process the data
                    processWholesalerData(jsonData);
                    
                } catch (error) {
                    console.error('Error reading XLSX file:', error);
                    alert('Error reading XLSX file. Please check the format.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processWholesalerData(data) {
            // Preview the data first
            const preview = document.getElementById('xlsx-preview');
            preview.innerHTML = `
                <h4>Preview (First 5 rows):</h4>
                <table border="1" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            ${Object.keys(data[0] || {}).map(key => `<th>${key}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${data.slice(0, 5).map(row => `
                            <tr>
                                ${Object.values(row).map(value => `<td>${value}</td>`).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <p><strong>Total rows:</strong> ${data.length}</p>
                <button class="btn" onclick="confirmImport(${JSON.stringify(data).replace(/"/g, '&quot;')})">Confirm Import</button>
                <button class="btn btn-secondary" onclick="document.getElementById('xlsx-preview').classList.add('hidden')">Cancel</button>
            `;
            preview.classList.remove('hidden');
        }

        function confirmImport(data) {
            const products = data.map((row, index) => {
                // Map your wholesaler's columns to your product structure
                // Adjust these field mappings based on your XLSX structure
                return {
                    id: `pm-${row['Product ID'] || row['SKU'] || `item-${index}`}`,
                    name: row['Product Name'] || row['Name'] || row['Title'] || 'Unknown Product',
                    price: parseFloat(row['Price'] || row['Cost'] || row['Wholesale Price'] || 0),
                    category: 'main',
                    description: row['Description'] || row['Details'],
                    brand: row['Brand'] || row['Manufacturer'],
                    model: row['Model'] || row['Model Number'],
                    color: row['Color'] || row['Finish'],
                    storage: row['Storage'] || row['Capacity'],
                    condition: row['Condition'] || row['Grade']
                };
            });
            
            // Apply 22% markup
            products.forEach(product => {
                product.price = parseFloat((product.price * 1.22).toFixed(2));
            });
            
            // Replace current inventory
            inventoryManager.inventory = products;
            inventoryManager.saveInventory();
            
            // Hide preview and show success
            document.getElementById('xlsx-preview').classList.add('hidden');
            inventoryManager.showAlert(`Successfully imported ${products.length} products!`, 'success');
            
            // Refresh the display
            inventoryManager.updateDashboard();
            inventoryManager.loadInventoryGrid();
        }
        
        // Initialize the inventory manager (will be created when user authenticates)
        let inventoryManager;
    </script>
</body>
</html>
